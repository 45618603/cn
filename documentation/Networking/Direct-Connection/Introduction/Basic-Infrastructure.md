## **基础架构**

#### **概述**

专线服务整体架构图如下：

 ![](/image/Networking/Direct-Connect-Service/Infrastructure.png)



#### **专线服务的组件**

专线连接(Direct Connect)

- 物理连接(Connection)：用于连接京东云机房和客户IDC机房的物理链路。
- 专线通道(DirectConnect Tunnel)：用于连接物理连接和边界网关的逻辑链路。



托管连接(Hosted Connect)

- 托管专线(Hosted Connection)：用于连接京东云机房和客户所在的京东云托管区设备的物理链路。
- 托管通道(HostedConnect Tunnel)：用于连接托管专线和边界网关的逻辑链路。



边界网关(BGW，Border Gateway)：承载VPC之间、VPC与外部私有环境进行通信的网关，目前已承载的功能为专线服务、托管服务、VPN连接、VPC接口。


VPC接口(VPC Attachment)：京东云VPC与边界网关之间的互联接口。



#### **高可用架构**

专线服务的所有组件全部采用/支持高可用架构设计，其中：

- 物理连接/托管专线，建议客户在同地域接入两根以上的物理链路，以保障物理链路的高可用性。
- 边界网关，客户创建边界网关时，会默认创建双活模式的边界网关。
- 专线通道/托管通道，客户创建通道时，会默认创建双活模式的专线通道/托管通道。

#### **边界网关与VPC互通方式调整说明**

1）互通方式调整

边界网关支持VPC接口功能前，边界网关一旦创建、即自动与同地域的所有VPC连通；

随着边界网关的VPC接口功能上线，新建的边界网关默认不与任何VPC连通，用户需要创建"VPC接口”用于打通指定VPC和边界网关的互联；对于已经创建的边界网关，边界网关路由表内已有到VPC的路由仍然有效可用、并且可以修改删除，但是不能新建到VPC的路由、除非先创建出与VPC关联的VPC接口。

2）路由方式调整

边界网关支持VPC接口功能前，边界网关路由表和VPC路由表仅支持静态路由；

随着边界网关的VPC接口功能上线，边界网关路由表和VPC路由表都新增支持动态传播路由。

边界网关的有效路由可自动传播到创建关联的VPC路由表内，到达VPC子网网段的路由可自动传播到边界网关路由表；边界网关与IDC网关可通过eBGP相互宣告有效路由。具体过程如下：

边界网关通过专线通道、托管通道学习到的BGP路由，以及通过创建VPC接口时指定的VPC子网网段访问路由，都会以传播路由的方式添加到边界网关的动态路由表内、并且会通过路由优先级比对后把高优先级路由添加到有效路由表；VPC路由表通过创建路由传播、可以将边界网关有效路由表中目的地址在传播地址范围内的路由规则动态传播到VPC路由表内；边界网关会将有效路由通过eBGP宣告给IDC网关的BGP Peer。

## 边界网关

BGW作为VPC的边界网关，主要满足VPC访问Internet之外的私网互访需求，支持VPC之间、VPC与专线通道和托管通道的互通，用户根据需求自行创建互联接口与通道，并通过配置路由表实现不同业务端之间的互通。


### 创建边界网关

1.登录京东云控制台。

2.点击左侧导航栏，选择“混合云连接 -> 边界网关 -> 边界网关”，进入边界网关列表，点击【创建】。

3.创建边界网关。
  边界网关支持VPC接口前，边界网关一旦创建、即自动与同地域的所有VPC连通。
  随着边界网关支持VPC接口的功能上线，新建的边界网关默认不与任何VPC连通，用户需要创建"VPC接口”用于打通指定VPC和边界网关的互联；对于已经创建的边界网关，边界网关路由表内已有到VPC的路由仍然有效可用，但是不能新建到VPC的路由、除非先创建出与VPC关联的VPC接口。

### **创建边界网关的VPC接口**

1.登录京东云控制台。

2.点击左侧导航栏，选择“混合云连接 -> 边界网关 -> VPC接口”，进入VPC接口列表页，点击【创建】。

3.配置VPC接口，以便边界网关与选定的VPC建立连接、进行互通，详见控制台页面。

目前VPC接口仅支持同地域的VPC与边界网关互联。同一个VPC和同一个边界网关只能创建一个VPC接口。同一个VPC可与多个不同边界网关创建不同的VPC接口，另外一个边界网关支持与多个不同VPC创建不同的VPC接口

主要配置项如下：

- - 接口名称：边界网关与VPC连接的接口名称；

  - 边界网关：选择需要互联的边界网关。边界网关对内与VPC进行通信，同时可作为京东云侧和客户IDC侧运行BGP的终结点；
  
  - VPC：选择需要互联的VPC；
  
  - 传播的VPC网段：
  
    ``VPC全部网段``，边界网关的路由全自动引入方式，表示系统将自动在边界网关的路由表内添加访问VPC全网段的路由表项。全网段包括VPC当前全部子网的网段，并且将根据VPC子网后续的变化自动更新边界网关的路由表项——如后续新增子网时、系统将自动将到达新子网的路由添加到边界网关路由表，删除子网时、自动同步删除边界网关对应的路由表项。
    
    ``指定子网网段``，边界网关的路由半自动引入方式，表示系统将自动在边界网关的路由表内添加访问VPC内已指定网段的路由。这种方式下，边界网关的路由将不会自动适配VPC内指定子网以外的调整，如新增或者删除指定范围外的子网都不会引起边界网关的路由变化；但若是指定范围内的子网变化，如删除范围内子网，需要先删除VPC接口的指定子网网段。
    
    ``不传播网段``，边界网关的路由全手动配置方式，表示系统不会自动在边界网关路由表内添加任何访问VPC的路由，需要用户在BGW路由表内手动配置静态路由。

4.单击“确定”，在VPC接口列表中，该通道的状态为配置中。

5.边界网关接口完成配置后，通道状态变为可用，此时即可使用该连接进行数据传输。

``特殊说明：当边界网关互联的VPC内子网与其他通道连接目的端的IP网段存在重叠时，创建VPC接口时可选“指定子网网段”、并选相互不重叠的子网网段，避免重叠VPC子网网段传播到边界网关路由表，以满足边界网关多个通道连接端的IP地址段存在重叠的应用场景需求``


### **创建专线通道**

1.登录京东云控制台。

2.点击左侧导航栏，选择“混合云连接 -> 专线连接 -> 专线通道”，进入专线通道列表页，点击【创建】。

3.配置专线通道，详见控制台页面。

4.单击“确认”，在专线通道列表页中，该通道的状态为配置中。

5.专线通道完成配置后，通道状态变为可用，此时即可使用该专线通道。


### **配置边界网关上的路由表**

1.登录京东云控制台。

2.点击左侧导航栏，选择“专线服务 -> 边界网关”，进入边界网关列表页，点击边界网关ID、进入详情页面，选择“路由表”页签。

3.配置路由表，需要配置双向的路由，即通往VPC侧的路由、通往您的IDC侧的路由。

1）通往IDC侧的路由，有两种方式：静态路由方式，路由自动传播方式。

路由自动传播方式：

如果边界网关已经创建了与托管区互联的通道（如托管通道等），并且运行了BGP协议进行两端动态路由学习，边界网关会将通过BGP学习到的路由自动添加到动态路由表内目的端、下一跳为与托管区互联的通道（如托管通道）、路由类型为传播。动态传播路由将与静态路由表的路由统一进行优先级比对，高优先级路由会自动加入有效路由表内。动态传播路由用户直接在路由表内查看即可、不需要用户配置，用户也不可以修改、删除动态传播路由。

静态路由方式：

如果用户想自行控制路由，可以选择“静态路由表”通过手动配置添加，同前缀路由的静态路由比传播路由优先级高，因此同前缀传播路由将从有效路由表删除。添加静态路由规则时，目的端为您的IDC内的网段，下一跳类型选择专线通道，下一跳选择用于承载专线连接网络互通的专线通道。

2）通往VPC侧的路由，有两种方式：静态路由方式，路由自动传播方式。

静态路由方式：

当创建边界网关与VPC互联的VPC接口时，如果传播VPC网段选择“不传播网段”时，需要手动配置到达多个VPC的路由，即逐项配置通往所有需要互通的VPC侧的静态路由。配置通往VPC侧的静态路由，选择“路由表->静态路由表”，点击“编辑”，路由规则目的端为VPC内的网段，下一跳类型选择VPC接口，下一跳选择要进行通信的具体VPC接口信息。

路由自动传播方式：

当创建边界网关与VPC互联的VPC接口时，如果传播VPC网段选择“VPC全部网段”或者“指定子网网段”时，即为路由自动传播方式。边界网关路由表会依据配置的子网范围，自动添加或者删除到达相关子网的路由表项，目的网段为VPC子网网段、下一跳类型选择VPC接口、下一跳为连接指定VPC和边界网关的VPC接口、路由类型为传播。动态路由将与有效路由表的路由进行优先级比对，高优先级路由会自动加入有效路由表内。用户直接在路由表内查看动态传播路由、不需要用户配置，用户也不可以修改、删除动态传播路由。




### **删除专线通道**

1.登录京东云控制台。

2.点击左侧导航栏，选择“混合云连接 -> 专线连接 -> 专线通道”，进入专线通道列表页，点击操作下【删除】。

3.进入专线通道列表页或详情页，点击“删除”，即可删除专线通道。删除接口/通道后，传播到边界网关的路由会同步移除。


### **删除边界网关的VPC接口**

1.登录京东云控制台。

2.点击左侧导航栏，选择“混合云连接 -> 边界网关 -> VPC接口”，在VPC接口列表页的操作栏选择【删除】；或者在“混合云连接 -> 边界网关 -> 边界网关”、选择边界网关ID进入详情页的“接口/通道”页签、点击操作栏下【删除】。

3.删除边界网关的VPC接口。删除VPC接口后，VPC路由表的传播关系、VPC以及BGW相应的传播路由和静态路由都会被自动删除。


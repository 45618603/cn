# 从NAT实例向NAT网关迁移

如果用户已经在使用NAT实例，可以通过以下步骤将NAT实例迁移到NAT网关。

1. 在创建NAT实例的子网内创建NAT网关

2. 编辑原有指向NAT实例的路由表，假设路由表已经存在一个路由表项，目的地址为0.0.0.0/0  下一跳类型为云主机，下一跳地址为NAT实例所在云主机
在此路由表上，新建8条路由条目，目标网段分别为 1.0.0.0/8、2.0.0.0/7、4.0.0.0/6、8.0.0.0/5、16.0.0.0/4、32.0.0.0/3、64.0.0.0/2、128.0.0.0/1，下一跳均为NAT实例。
根据路由表的最长匹配原则，去往任意IP的数据包，都会匹配到这8条路由。因为0.0.0.0/0这条路由实际已经不再起作用

3. 将0.0.0.0/0这条路由的下一跳变更为最新创建的NAT网关。

4. 逐条删除之前创建的8条路由，每删除一条路由，对应网段的流量就会转到NAT网关上

注：

       1. 在迁移过程中，已有的TCP连接会中断，需要重新连接，新建连接不受影响。UDP不受影响
       
       2. NAT实例绑定的公网IP不能迁移到NAT网关，因为迁移后，公网IP会发生变化，请及时调整相关的规则

       3. 如果用户使用多个NAT实例，可以根据实际流量和连接数情况，考虑用一个或多个NAT网关替换
